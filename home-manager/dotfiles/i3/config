# =============================================================================
# VARIABLES
#
# Using variables makes it easy to change settings consistently across the
# entire configuration file.
# =============================================================================

# Set the primary modifier key. Mod4 is typically the "Super" or "Windows" key.
set $mod Mod4

# Set an alternative modifier key. Mod1 is typically the "Alt" key.
set $alt Mod1

# Define your preferred terminal emulator.
set $terminal alacritty

# Define your application launcher. Rofi is a popular choice.
set $launcher "rofi -show combi -sidebar-mode"

# Define a window switcher, also using Rofi.
set $window_switcher "rofi -show window"


# =============================================================================
# UI & APPEARANCE
#
# This section controls the visual aspects of i3, such as fonts and borders.
# =============================================================================

# Set the global font for window titles.
# 'pango:' enables more advanced font rendering, including ligatures.
font pango:Fira Code 12

# Allow dragging of floating windows with the mouse by holding the modifier key.
floating_modifier $mod

# Set the default border style for new windows. 'none' removes borders entirely.
default_border none

# Explicitly remove borders from all windows for a cleaner look.
for_window [class="^.*"] border pixel 0


# =============================================================================
# KEYBINDINGS
#
# This is the core of i3 usability, defining keyboard shortcuts to manage
# your windows and session.
# =============================================================================

# --- Application Shortcuts ---
# Open a new terminal window.
bindsym $mod+Return exec $terminal

# Open the application launcher (Rofi).
bindsym $alt+d exec $launcher

# Open the window switcher to find and focus a specific window.
bindsym $mod+Tab exec $window_switcher


# --- Window and Container Management ---
# Close the currently focused window.
bindsym $mod+Shift+q kill

# A more aggressive kill: focuses the parent container after killing the child.
bindsym $mod+Shift+a focus parent, kill

# Change window focus using vim-style keys (J-K-L-;).
bindsym $mod+j focus left
bindsym $mod+k focus down
bindsym $mod+l focus up
bindsym $mod+semicolon focus right

# Alternatively, use arrow keys to change focus.
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# Move the focused window using vim-style keys.
bindsym $mod+Shift+j move left
bindsym $mod+Shift+k move down
bindsym $mod+Shift+l move up
bindsym $mod+Shift+semicolon move right

# Alternatively, use arrow keys to move the focused window.
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# Change the split orientation for the next window.
bindsym $mod+h split h # Split horizontally (windows side-by-side).
bindsym $mod+v split v # Split vertically (windows on top of each other).

# Toggle fullscreen mode for the focused window.
bindsym $mod+f fullscreen toggle

# Change the layout of the current container.
bindsym $mod+s layout stacking  # Stack windows on top of each other.
bindsym $mod+w layout tabbed    # Group windows into tabs.
bindsym $mod+e layout toggle split # Switch between horizontal and vertical split.

# Toggle a window between tiling and floating mode.
bindsym $mod+Shift+space floating toggle

# Switch focus between tiling and floating windows.
bindsym $mod+space focus mode_toggle

# Navigate the window tree.
bindsym $mod+a focus parent # Focus the parent container.
#bindsym $mod+d focus child # Uncomment to enable focusing child containers.


# --- i3wm Session Management ---
# Reload the i3 configuration file after making changes.
bindsym $mod+Shift+c reload

# Restart i3 in place (useful for upgrades without losing your session).
bindsym $mod+Shift+r restart

# Exit i3, ending your X session (shows a confirmation dialog).
bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -B 'Yes, exit i3' 'i3-msg exit'"

# Lock the screen.
bindsym $mod+Shift+w exec "i3lock-color -k --keylayout 0 --image $HOME/.background-image-blur"


# --- Resize Mode ---
# Enter a special mode for resizing windows with the keyboard.
bindsym $mod+r mode "resize"

mode "resize" {
    # Use vim-style keys to resize the focused window.
    bindsym j resize shrink width 10 px or 10 ppt
    bindsym k resize grow height 10 px or 10 ppt
    bindsym l resize shrink height 10 px or 10 ppt
    bindsym semicolon resize grow width 10 px or 10 ppt

    # Use arrow keys for resizing as an alternative.
    bindsym Left resize shrink width 10 px or 10 ppt
    bindsym Down resize grow height 10 px or 10 ppt
    bindsym Up resize shrink height 10 px or 10 ppt
    bindsym Right resize grow width 10 px or 10 ppt

    # Return to the default mode.
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym $mod+r mode "default"
}


# =============================================================================
# WORKSPACES
#
# This section defines your workspaces and how you interact with them.
# =============================================================================

# --- Numbered Workspace Definitions ---
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10"

# --- Named Workspace Definitions for Specific Applications ---
set $ws_terminal "terminal"
set $ws_web "web"
set $ws_code "code"
set $ws_clion "clion"
set $ws_idea "idea"
set $ws_obsidian "obsidian"
set $ws_msg "msg"
set $ws_discord "discord"
set $ws_slack "slack"
set $ws_thunderbird "thunderbird"
set $ws_spotify "spotify"

# --- Switch to Workspaces ---
# Switch to numbered workspaces.
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5
bindsym $mod+6 workspace $ws6
bindsym $mod+7 workspace $ws7
bindsym $mod+8 workspace $ws8
bindsym $mod+9 workspace $ws9
bindsym $mod+0 workspace $ws10

# Switch to named workspaces.
bindsym $mod+u workspace $ws_web
bindsym $mod+c workspace $ws_code
bindsym $mod+y workspace $ws_clion
bindsym $mod+i workspace $ws_idea
bindsym $mod+o workspace $ws_obsidian
bindsym $mod+m workspace $ws_msg
bindsym $mod+d workspace $ws_discord
bindsym $mod+n workspace $ws_slack
bindsym $mod+t workspace $ws_thunderbird
bindsym $mod+p workspace $ws_spotify

# A custom script to switch to the terminal workspace with a double tap of Super.
bindsym Super_L exec --no-startup-id $HOME/.config/scripts/double_mod_switch.sh

# --- Move Focused Container to Workspaces ---
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5
bindsym $mod+Shift+6 move container to workspace $ws6
bindsym $mod+Shift+7 move container to workspace $ws7
bindsym $mod+Shift+8 move container to workspace $ws8
bindsym $mod+Shift+9 move container to workspace $ws9
bindsym $mod+Shift+0 move container to workspace $ws10

# --- Workspace Behavior ---
# When switching to a workspace, switch back to the previous one on the next press.
workspace_auto_back_and_forth yes

# Automatically focus new windows when they are created.
focus_on_window_activation focus


# =============================================================================
# APPLICATION ASSIGNMENTS TO WORKSPACES
#
# Automatically move specific applications to designated workspaces upon opening.
# =============================================================================

# Assign applications to workspaces and specify which monitor they should open on.
assign [class=".*[A,a]lacritty.*"] $ws_terminal
workspace $ws_terminal output DP-1 eDP-1

assign [class=".*[l,l]ibrewolf.*|.*[F,f]irefox.*|.*[C,c]hromium.*|.*[F,f]loorp.*"] $ws_web
workspace $ws_web output eDP-1 DP-1

assign [class=".*[C,c]ode.*"] $ws_code
workspace $ws_code output DP-1 eDP-1

assign [class=".*[C,c]lion.*"] $ws_clion

assign [class=".*[I,i]dea.*"] $ws_idea
workspace $ws_idea output DP-1 eDP-1

assign [class=".*[O,o]bsidian.*"] $ws_obsidian
workspace $ws_obsidian output DP-1 eDP-1

assign [class=".*telegram-desktop.*"] $ws_msg
workspace $ws_msg output eDP-1 DP-1

assign [class=".*[D,d]iscord.*"] $ws_discord
workspace $ws_discord output eDP-1 DP-1

assign [class=".*[S,s]lack.*"] $ws_slack
workspace $ws_slack output eDP-1 DP-1

assign [class=".*[T,t]hunderbird.*"] $ws_thunderbird
workspace $ws_thunderbird output eDP-1 DP-1

assign [class=".*[S,s]potify.*"] $ws_spotify
workspace $ws_spotify output eDP-1 DP-1


# =============================================================================
# i3bar CONFIGURATION
#
# Settings for the status bar at the top or bottom of the screen.
# =============================================================================

bar {
    position top
    font pango: FiraCode Nerd Font 16
    status_command i3status-rs ~/.config/i3/status.toml
    colors {
        separator #666666
        background #222222
        statusline #dddddd
        focused_workspace #0088CC #0088CC #ffffff
        active_workspace #333333 #333333 #ffffff
        inactive_workspace #333333 #333333 #888888
        urgent_workspace #2f343a #900000 #ffffff
    }
}


# =============================================================================
# HARDWARE & MEDIA KEYS
#
# Bind hardware keys (like volume, brightness, and media controls) to actions.
# =============================================================================

# --- Audio Controls (using PipeWire with pamixer) ---
bindsym XF86AudioRaiseVolume exec --no-startup-id pamixer -i 5
bindsym XF86AudioLowerVolume exec --no-startup-id pamixer -d 5
bindsym XF86AudioMute exec --no-startup-id pamixer -t

# --- Screen Brightness Controls (using brillo) ---
bindsym XF86MonBrightnessUp exec --no-startup-id brillo -A 5
bindsym XF86MonBrightnessDown exec --no-startup-id brillo -U 5

# --- Media Player Controls (using playerctl) ---
bindsym XF86AudioPlay exec playerctl play
bindsym XF86AudioPause exec playerctl pause
bindsym XF86AudioNext exec playerctl next
bindsym XF86AudioPrev exec playerctl previous

# --- Touchpad Controls ---
# bindsym XF86TouchpadToggle exec /path/to/toggletouchpad.sh # Uncomment and configure if needed.


# =============================================================================
# STARTUP APPLICATIONS & SCRIPTS
#
# Commands to run when i3 starts or restarts.
# =============================================================================

# --- Display Configuration ---
# Set screen layout and DPI. Uncomment and adjust for your setup.
# exec --no-startup-id xrandr --output eDP-1 --auto --dpi 80
# exec --no-startup-id xrandr --output DP-1 --auto --above eDP-1 --dpi 80

# --- Autostart System and Application Services ---
# 'exec_always' runs on every start and restart of i3.
exec_always --no-startup-id nm-applet # Network Manager applet.

# 'exec' runs only when i3 is first started.
exec --no-startup-id i3-msg "workspace $ws_terminal; exec $terminal"
exec --no-startup-id i3-msg "workspace $ws_web; exec floorp"
exec --no-startup-id i3-msg "workspace $ws_idea; exec idea"
exec --no-startup-id i3-msg "workspace $ws_msg; exec telegram-desktop"
exec --no-startup-id i3-msg "workspace $ws_thunderbird; exec thunderbird"

# --- Background and Wallpaper Script ---
exec_always --no-startup-id $HOME/.config/scripts/update_background_image.sh
